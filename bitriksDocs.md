Админка
site.com/bitriks/admin

Ядро CMS
``
/bitrix/modules/ 
``

Файлы системных компонентов
``
/bitrix/components/bitrix/
``
Чтобы шаблоны сайтов, компонентов не вызывались в браузере

``
<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>
``

Установка vm на centos, скрипт или tar.gz (nginx config?)

Структура сайта в рамках Bitrix Framework:
---
Шаблон - определяет представление сайта пользователям. Существуют шаблоны компонентов и шаблоны сайта. Компоненты - задают вывод данных. Страница - элемент структуры сайта.

Страница как и в WP
-header
-workarea
-footer

Шаблоны страниц лежат в
``
/bitrix/templates/.default/page_templates/; 
/bitrix/templates/ID шаблона сайта/page_templates/
``

Редактироввание шаблонов
---
Создав (открыв для редактирования) нужный шаблон (Настройки > Настройки продукта > Сайты > Шаблоны Сайтов); Выбрав Шаблон в меню Пуск (Настройки > Настройки продукта > Сайты > Шаблоны Сайтов); С помощью кнопки Шаблон сайта на Панели управления (Шаблон сайта > В Панели управления > Редактировать шаблон); Прямое редактирование файлов header.php и footer.php в папке шаблона.

Если структура сайта не понятна, то можно посмотреть в Администрирование -> Контент
Если нужно понять какой шаблон использутся в данный момент Администиррование -> Настройки -> Настройка продукта -> Сайты -> Шаблоны сайтов

Структура шаблона
---
каталог /components – предназначен для шаблонов компонентов; 
каталог /images – предназначен для картинок шаблона (которые не зависят от просматриваемой страницы), копируется из верстки сайта;
каталог /include_areas – содержит включаемые области шаблона;
каталог /lang – содержит файлы языковых сообщений; каталог /page_templates – для шаблонов страниц и редактируемых областей; каталог /snippets – содержит сниппеты – маленькие фрагменты html-кода для ускорения работы контент-менеджера по созданию часто встречающихся блоков кода;
каталог /themes – тема оформления шаблона;
файл header.php – часть шаблона ДО контента; 
файл footer.php – часть шаблона ПОСЛЕ контента;
файл description.php – название и описание шаблона;
файл .styles.php – описания стилей для визуального редактора страниц; 
файл template_styles.css – стили шаблона (стили применяемые в самом шаблоне дизайна сайта); 
файл styles.css – стили для контента и включаемых областей. Эти стили можно применять в визуальном редакторе.

Управление шаблонами дизайна осуществляется в административном разделе на странице Шаблоны сайта (Настройки > Настройки продукта > Сайты > Шаблоны сайтов), где можно: изменить загрузить и копировать

На странице со списком шаблонов имеется специальная кнопка контекстной панели Загрузить шаблон.

Каскадные стили, используемые в шаблоне, рекомендуется разделять на две таблицы стилей, хранящиеся в двух разных файлах. Оба файла находятся в директории /bitrix/templates/<идентификатор_шаблона>/. Файл styles.css содержит стили для представления информационного содержания страницы на сайте. Файл template_styles.css содержит стили для отображения текстов в самом шаблоне дизайна.

и template_styles.css, подключаемым через showhead() стили шаблона

В битриксе все по "папочкам" то есть
у нас есть sitename.local/company
это означает что при запросе на url вызывается index.php лежищий по path company/index.php

Создание шаблона сайта рекомендуется выполнять на локальной демо-версии продукта. Готовый шаблон необходимо экспортировать средствами системы в виде комплекта файлов формата tar.gz на удаленный сервер и развернуть его.

Включаемые области
---
Включаемая область - это специально выделенная область на странице сайта, которую можно редактировать отдельно от основного содержания страницы. Включаемые области служат для размещения справочной информации, различных форм (подписки, голосования, опросов), новостей и любой другой статической и динамической информации. Также в виде включаемой области могут быть выполнены области с указанием авторских прав, графические ссылки, контактная информация, логотип компании и т.п.
включаемые области обозначаются inc

Для размещения включаемой области выполните следующее:
Откройте для редактирования шаблон сайта или страницу в визуальном редакторе.
Добавьте компонент Вставка включаемой области (bitrix:main.include) в шаблон сайта (или в тело страницы) и настройте его параметры.

То есть если надо включить файл как комопонет создаем на диске, затем добавляем inc_компонент, и далее добавить область как php

Хлебные крошки
---
```
/bitrix/components/bitrix/breadcrumb/templates/<название шаблона>/
```
когда речь идет о копмоненте структура сайта
Рабочий стол - Контент - Структура сайта - Корпоративный сайт: Широкий (Голубой)

Хлебные крошки шаблон дизайна -> компонент навигационная цепочка
можно добавить через административную панель либо через файл шаблона темы
```
<div id="breadcrums">
<?$APPLICATION->IncludeComponent('bitrix:breadcrumb','', array( "PATH"=> "", "SITE_ID" => "ip", "START_FROM" => "0" )) ?> 
</div>
```
Компоненты можно хранить в отдельной директории, потом подключать как php файлы в шаблоне
```
<? $APPLICATION->IncludeFile( SITE_DIR . "include/news.php", array(), array("MODE" => "html") ); ?>
```

Меню
---
Формирование меню
создание шаблона меню (создание шаблона компонента Меню);
включение функции показа меню (вызов компонента Меню) в общем шаблоне ("прологе" и "эпилоге");
заполнение меню в соответствии со структурой сайта.

Строится на основе двух составляющих

Любое меню на сайте строится на основе двух составляющих:
- массива данных $aMenuLinks, определяющего состав меню, задает названия и ссылки для всех пунктов меню. Управление массивом - - данных осуществляется через административный интерфейс;
- шаблона внешнего представления меню. Шаблон меню – это PHP код, определяющий внешний вид меню (шаблон компонента Меню). Шаблон меню обрабатывает массив данных, выдавая на выходе HTML-код.

Если нам нужен компоненто то копипастим директория themename\components\bitrix, то есть шаблон меню для темы furniture будет лежать в /bitrix/templates/furniture_blue/components/bitrix/menu/left/template.php
Примечание: Шаблон меню, если он является системным, перед изменением необходимо скопировать в текущий шаблон сайта. При редактировании такого шаблона из публичной части сайта системой автоматически будет предложена возможность копирования.

ДОбавление пункта меню
---
создаешь директорию на диске, потом через административную панель добавляешь каталог с названием
если надо много под меню создаешь под папочки вложенные в папочки

Меню из информационных блоков
---
Для решения этой задачи необходимо использовать компонент Пункты меню (bitrix:menu.sections).
```
<? if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die(); 
global $APPLICATION;
$aMenuLinksExt = $APPLICATION->IncludeComponent( "bitrix:menu.sections", // секция меню "", Array( "ID" => $_REQUEST["ID"], "IBLOCK_TYPE" => "books", "IBLOCK_ID" => "5", "SECTION_URL" => "/catalog/phone/section.php?", //дополнительное меню "DEPTH_LEVEL" => "1", "CACHE_TYPE" => "A", "CACHE_TIME" => "3600" ) );
$aMenuLinks = array_merge($aMenuLinks, $aMenuLinksExt);
?>
```

Условия для шаблонизатора
---
Если свойство раздела phone равно Y
```$APPLICATION->GetDirProperty("phone")=="Y"```

Если текущий раздел равен /ru/catalog/phone/

```$APPLICATION->GetCurDir()=="/ru/catalog/phone/"```

Если текущий пользователь - администратор
```$USER->IsAdmin()```

Произвольный контент
---
Теперь есть поддержка стандартного кеширования в компонентах.

template.php:
```
<?$this->SetViewTarget("sidebar");?> 
<div class="element-filter"> <!--вывод фильтра --> </div>
    <?$this->EndViewTarget();?> <div class="element-list">
 </div>
```

header.php куда включаем файл:
```
<div id="sidebar"> <?$APPLICATION->ShowViewContent("sidebar")?> </div>
```

Разработка шаблонов
---
Шаблоны страниц находятся в папке
Шаблоны страниц и редактируемых областей хранятся в папке /page_templates/, находящейся в каталоге соответствующего шаблона сайта или в папке /bitrix/templates/.default/, если предполагается использование одинаковых шаблонов страниц для всех шаблонов сайта.
То есть pwd будет
```
bitrix/templates/.default/page_templates/standard.php
```

Bootstrap
---
Bootstrap в Bitrix Framework

В Bitrix Framework для вёрстки шаблонов сайта и компонентов используется Bootstrap. При вёрстке шаблонов учитывайте что:
В БУС подключается не собственный вариант Bootstrap, а оригинальная, не изменённая поставка фреймворка в 4-ой версии.
Bootstrap подключается не в конкретном компоненте, а в целом на продукте из модуля main.
В Bootstrap рекомендуют кастомизировать стили в отдельном файле, обычно он называется bootstrap-theme.css. В случае с Bitrix Framework он называется template_style.css - для основного шаблона и style.css в каждом отдельном компоненте. В этом случае выше перечисленные файлы подключатся после основной библиотеки.
Если верстальщик не следует рекомендациям Bootstrap и нашей документации, то возможна ситуация, когда "плывёт" дизайн.

Простой пример внедрения блочной верстки
---
header (шапка, хедер, пролог) - верхняя часть дизайна; хранится в файле header.php шаблона сайта (Контент > Структура сайта > Файлы и папки > bitrix > templates > [ваш шаблон] );

WORK_AREA - рабочая область, содержащая основной контент; при создании страниц заполняется как раз эта область (например, Контент > Структура сайта > Файлы и папки > index.php );

footer (подвал, футер, эпилог) - нижняя часть дизайна; хранится в файле footer.php шаблона сайта (Контент > Структура сайта > Файлы и папки > bitrix > templates > [ваш шаблон] ).

Создаешь шаблон Рабочий стол->Настройки->Настройки продукта->Сайты->Шаблоны сайтов, закидываешь туда html верстку header и footer, там где в wp обычно контент циклом, тут #work_area#. Далее заполняешь поля. Готовый шаблон появляется в
```
bitrix/templates
```

Шаблонизатор
---

Первая строка
```
<? if (!defined('B_PROLOG_INCLUDED') || B_PROLOG_INCLUDED !== true) die(); ?>
```
Вывод заголовка
```
<title><? $APPLICATION->ShowTitle(); ?></title>
```
Код вывода в шаблоне сайта основных полей тега (мета-теги Content-Type, robots, keywords, description; стили CSS; скрипты):
```
<? $APPLICATION->ShowHead(); ?>
```
Панелька сверху
После открывающего body
```
<div id="panel"> <? $APPLICATION->ShowPanel(); ?> </div>
```
Если общаемся к файлам, налого abspath в wp
```
<?=SITE_TEMPLATE_PATH?>
```
код подключения напрямую
```
<script src="<?=SITE_TEMPLATE_PATH?>/vendor/jquery/jquery.min.js"></script> <script src="<?=SITE_TEMPLATE_PATH?>/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
```
если через ядро
```
if (!defined('B_PROLOG_INCLUDED') || B_PROLOG_INCLUDED !== true) die();
use Bitrix\Main\Page\Asset; //Подключение библиотеки для использования Asset::getInstance()->addCss() 
global $USER; 
<!DOCTYPE html> ...
```
в head
```
Asset::getInstance()->addJs(SITE_TEMPLATE_PATH . "/vendor/jquery/jquery.min.js");
Asset::getInstance()->addCss(SITE_TEMPLATE_PATH . "/vendor/fontawesome-free/css/all.min.css"); 
```
Подключение футера и подвала подвала
Для создания нового сайта необходимо создать директорию
далее закинуть туда index.php
добавляем туда

в начало:
```
<?require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");?> в конец: <?require($_SERVER["DOCUMENT_ROOT"]."/bitrix/footer.php");?>
```
и заменить шаблон
если ошибка доступа для директорий 755 и 644 для файлов
в background / от коня диска

Итого шаблоны в templates index в папку в файла все остальное в настройках Сайты

Кастомизация шаблона компонентов на основе списка новостей
---
Для создания шаблона компонента на основе готового создаем директорию
```
bitrix/templates/Fishing/components/bitrix/news.list/newsTemplate/template.php
```

где newsTemplate название кастомного шаблона
template.php код шаблона
Далее как в twig только вместо твига уаз буханка
```
<? foreach ($arResult["ITEMS"] as $arItem): ?> 
    <? $this->AddEditAction($arItem['ID'], $arItem['EDIT_LINK'], CIBlock::GetArrayByID($arItem["IBLOCK_ID"], "ELEMENT_EDIT")); 
    $this->AddDeleteAction($arItem['ID'], $arItem['DELETE_LINK'], CIBlock::GetArrayByID($arItem["IBLOCK_ID"], "ELEMENT_DELETE"), array("CONFIRM" => GetMessage('CT_BNL_ELEMENT_DELETE_CONFIRM'))); ?>
    <div class="col-lg-4 text-center"> 
        <div class="card bg-secondary border border-dark"> 
            <img class="card-img-top" src="<?= $arItem["PREVIEW_PICTURE"]["SRC"] ?>" alt="<? echo $arItem["NAME"] ?>"> 
                <div class="card-body "> 
                     <h5 class="card-title"><? echo $arItem["NAME"] ?></h5>
                     <? if ($arParams["DISPLAY_PREVIEW_TEXT"] != "N" && $arItem["PREVIEW_TEXT"]): ?> 
                        <p class="card-text"><? echo $arItem["PREVIEW_TEXT"]; ?></p> 
                    <? endif; ?>
                        <a href="<? echo $arItem["DETAIL_PAGE_URL"] ?>" class="btn btn-primary">Подробнее</a> 
                </div> 
        </div> 
    </div> 
<? endforeach; ?>
```
Если ошибка записи, то 95% это права на файлы в директории (вопрос как настраивать под nginx с nobody)

Туториал с utc11
====
Установка
---
Минимальная установка
bitrix - обязательная папка в которой хранится ядро CMS Bitrix
upload - папка с медиафайлами и другими загружаемыми файлами файлами в Битрикс
.access.php - файл в котором задаются права на текущую папку (есть почти в каждой папке Битрикс)
.htaccess - файл настройки веб-сервера Apache
web.conf - файл дополнительных настроек веб-окружения (не трогаем)
index.php

Создание шаблона 1С Битрикс
---
Шаблон и другая кастомизация кладется в директорию /local в корне сайта. Общий путь
```
local/templates/starshop
```

Минимальный набор
---
description.php - файл описания шаблона. Это описание будет отображаться в административной части битрикс (в админки). 
styles.css - это стили которые будут использоваться при редактировании контента (нужен контент менеджеру, у нас будет пустым)
template_styles.css - основной файл css-стилей шаблона (в нем будем создать собственные стили)
header.php - файл содержит шапку шаблона footer.php - файл содержит подвал шаблона (в этих файлах мы будем редактировать шаблон)

А разделителем на два файла служит специальная строка #WORK_AREA#. Т.е. все что выше разделителя #WORK_AREA# попадает в header.php, а что ниже в файл footer.ph

Далее берем шаблон от верстальщика и распакововыеам в local/templates/templateName

Далее идем в настройки сайта и выбриаем применить наш шаблон

Код шапки
---
Работа в шаблоне происходит с через класс CMain. Доступ к этому классу в шаблонах осуществляется через глобальную переменную $APPLICATION, что сокращает и упрощает вызываемый код.

```
<title><?$APPLICATION->ShowTitle();?></title> //заголовок <?$APPLICATION->ShowHead();?> // выводим все необходимые объявления Битрикс в <head>
```
Это и стили Битрикс для административной панели, и подключения его скриптов и другие файлы. 
```
<link rel="icon" href="<?=SITE_TEMPLATE_PATH?>/ico/favicon_bx.png"> //SITE_TEMPLATE_PATH глобальная переменная $APPLICATION->SetAdditionalCSS(SITE_TEMPLATE_PATH.'/css/1.css); - этой строкой мы подключаем стили. 
```

Если что-то не подключается проверь права.

В заключении. Создаешь директорию local, templates, далее название шаблона, футер, хедер с подключением ассетов, и применяешь шаблон сайт в настройках

Вывод меню.
---
Создавать меню проще всего в момент создания иерархии папок на сайте. Но можно редактировать меню и после того, как структура сайта будет создана
Посмотреть меню на сайте
Настройки - Настройка продукта - Настройка модулей - Структура сайта.

Добавляем директорию и выбираем к какому меню ее прикрепить

После чего в корне сайта появится .top.menu.php

В этом файле лежит обычный массив

Вывод через компонент bitriks.

Пункт 1. Добавление меню в шапку
из \bitrix\components\bitrix, копируем в
local/templates/startshop/components/bitrix
или просто добавляем на главную страицу через изменить страницу добавить компнонент меню, в нем выбрать "Главное меню" если это верхнее меню.
Затем переносим его в header.php
Если меню не появилось проверь root menu type

Пункт 2. Шаблон
каталоге шаблона оставляем только template.php и в нем соотвественно верстка самого меню.
Далее шаблонизатор стайл.

Вывод пунктов меню идет в $arResult дале foreach делаем
```
<?foreach ($arResult as $key=>$item): ?>
    <li> <a href="<?=$item['LINK']?>"> <?=$item['TEXT']?> </a></li> 
<? endforeach;?>
```
Код довольно таки простой по меркам Битрикса. В массив $arResult компонент меню передает массив пунктов меню. Dо всех шаблонах компонентов Битрикс результат работы компонента передается в шаблон через массив $arResult, а в массиве $arParams передаются параметры заданные для компонента программно или вручную через настройки, как мы делали выше. Затем выполняется цикл по массиву $arResult при этом полученные значения записываются в переменную item (item(arResult as $key => $item). И ниже в теге выводится ссылка и название пункта уже из именованного массива item .<?=item.<?=item['LINK']?> вот такой конструкцией в Битриксе принято выводить значения переменных.

Инфоблоки
---
Инфоблок - это сущность объединяющая в себе несколько таблиц в базе данных. Он позволяет работать с базой данных не задумываясь о структуре таблиц и взаимосвязях между ними. Для работы с инфоблоком существует специальное API. Так же инфоблок представлен в административной части сайта и имеет весь необходимый набор визуальных команд для просмотра и редактирования информации в инфоблоке. Практически всё, что делается в системе в той или иной мере завязано на этот модуль, даже если это и не отображается явно.

Пункт 1.
Создание инфоблока

Контент->Инфоблоки

- Добавить новый тип, например Каталог

- Далее добавляем инфоблок в Каталог, например товары

- Прописываем свойства


Инфоблоки можно экспортировать через CSV или XML. В первом случае данные, выгружены не будут, во втором выгрузка идет вместе с блоками, например картинками

Кастомизация компонента bitriks:news

После копирования компонента в каталоге шаблона появится директория local\templates\startshop\components\bitrix\news\catalog
bitriks:news - комплексный компонент, который содержит в себе простые компоненты в каталоге \bitrix\news\catalog
Нас интересует news.list в котором мы как всегда удалем все что не нужно и оставляем .parameters.php и template.php
Далее правим шаблон вывода новостей

```
setFrameMode(true); ?>
```

```
<div class="grid-x grid-padding-x large-up-4">
    <? foreach ($arResult["ITEMS"] as $key=>$item): ?> //Включает возможность изменять элемент из публички
        <? $this->AddEditAction($item['ID'], $item['EDIT_LINK'], CIBlock::GetArrayByID($item["IBLOCK_ID"], "ELEMENT_EDIT"));
        $this->AddDeleteAction($item['ID'], $item['DELETE_LINK'], CIBlock::GetArrayByID($item["IBLOCK_ID"], "ELEMENT_DELETE"), array("CONFIRM" => GetMessage('Подтверждаете удаление?'))); ?>
        <div class="cell bord" id="<?=$this->GetEditAreaId($item['ID'])?>"> 
            <img class="thumbnail" src="<?=$item['PREVIEW_PICTURE']['SRC']?>">
            <h5><a href="<?=$item["DETAIL_PAGE_URL"]?>"></h5>
            <p class="price"><strong><?=$item["NAME"]?></strong></p>   конструкция для доступа к вложенным пропсам массива
            <p class="price"><strong><?=$item["PROPERTIES"]["PRICE"]["VALUE"]?></strong></p>
            <a href="#" class="button_expanded">Купить</a> 
        </div> 
    <? endforeach; ?> 
</div>
```

Код компоенента
```
<div class="cell bord" id="<?=$this->GetEditAreaId($item['ID']);?>"> - здесь на блок вешается кнопка вызова редактора из публичной части.
    <img class="thumbnail" src="<?=$item['PREVIEW_PICTURE']['SRC']?>"> - этой строкой выводим изображение 
    <h5><a href="<?=$item['DETAIL_PAGE_URL']?>"><?=$item['NAME']?></a></h5> - этой строчкой выводим наименование товара и ссылку на детальную страницу
    <p class="price"><b><?=$item['PROPERTIES']['PRICE']['VALUE']?></b></p> - а здесь из свойств инфоблока выводится цена 
    <a href="#" class="button expanded">Купить</a> - кнопка купить 
</div> 
```

Параметры компонента bitrix и result_modifier.php
---
Если разный размер жипегов, то у битрикса есть автоматический ресайзер CFile::ResizeImageGet.
```
<? foreach($arResult["ITEMS"] as $cell=>$arElement) { 
    if($arElement["PREVIEW_PICTURE"]["ID"]) {
        $file = CFile::ResizeImageGet($arElement["PREVIEW_PICTURE"]["ID"],array('width' => 200,'height' => 200), BX_RESIZE_IMAGE_EXACT, true); 
        $arResult["ITEMS"][$cell]["PREVIEW_PICTURE"]['WIDTH'] = $file['width']; 
        $arResult["ITEMS"][$cell]["PREVIEW_PICTURE"]['HEIGHT'] = $file['height']; 
        $arResult["ITEMS"][$cell]["PREVIEW_PICTURE"]['SRC'] = $file['src'];
    }
endforeach;?>        
```

Данный код можно разместить и в самом шаблоне компонента news.list или в специальном файле result_modifier.php, который должен находится в то же директории где и файл шаблона компонента.
Файл result_modifier.php - инструмент для модификации данных работы компонента произвольным образом. Создается разработчиком самостоятельно.

